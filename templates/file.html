<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>File Download</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'nonce-{{nonce}}'; style-src 'self' 'unsafe-inline'; img-src 'self'; connect-src 'self'; form-action 'self'; base-uri 'self';">
    <style>
        :root { --bg:#f0f2f5; --text:#000; --border:#000; --accent:#4DEEEA; --font:'Courier New', monospace; }
        body { margin:0; min-height:100vh; display:grid; place-items:center; background:var(--bg); color:var(--text); font-family:var(--font); padding:20px; }
        .neo { background:#fff; border:3px solid var(--border); box-shadow:5px 5px 0 0 #000; padding:25px; width:min(450px, 95vw); }
        h2 { margin-top:0; word-break:break-all; text-transform:uppercase; }
        .btn { display:block; background:var(--accent); color:var(--text); text-align:center; padding:15px; text-decoration:none; font-weight:900; font-size:20px; border:3px solid var(--border); box-shadow:5px 5px 0 0 #000; margin:25px 0; }
        .btn:active { transform:translate(2px,2px); box-shadow:3px 3px 0 0 #000; }
        .grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; }
        .box { border:3px solid var(--border); padding:10px; background:#eee; box-shadow:3px 3px 0 0 #000; }
        .lbl { font-weight:bold; display:block; font-size:12px; margin-bottom:5px; text-transform:uppercase; }
        .val { font-weight:bold; font-size:14px; }
    </style>
</head>
<body>
    <div class="neo">
        <h2 id="safe-name">Loading...</h2>
        
        <a class="btn" href="/d/{{token}}">DOWNLOAD FILE</a>
        
        <div class="grid">
            <div class="box"><span class="lbl">Size:</span><span class="val" id="sz">{{size}}</span></div>
            <div class="box"><span class="lbl">Expires:</span><span class="val ts">{{expires}}</span></div>
            <div class="box" style="grid-column:span 2"><span class="lbl">Token:</span><span class="val" style="font-size:12px">{{token}}</span></div>
        </div>
    </div>

    <div id="raw" style="display:none;">{{filename}}</div>

    <script nonce="{{nonce}}">
        // 1. Safely extract raw text (strips HTML tags implicitly by reading textContent)
        const rawName = document.getElementById('raw').textContent;
        // 2. Safely insert into DOM
        document.getElementById('safe-name').innerText = rawName;
        document.title = rawName;

        // Formatting logic
        document.querySelectorAll('.ts').forEach(el => {
            el.innerText = new Date(parseInt(el.innerText) * 1000).toLocaleString();
        });
        const el = document.getElementById('sz');
        let s = parseInt(el.innerText), u = ['Bytes','KB','MB','GB'], i = 0;
        while(s >= 1024 && i < 3) { s /= 1024; i++; }
        el.innerText = s.toFixed(2) + ' ' + u[i];
    </script>
</body>
</html>
